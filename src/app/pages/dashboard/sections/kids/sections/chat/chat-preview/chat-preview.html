<div class="chat-preview">
  <div class="preview-left" aria-hidden="true">
    <div class="preview-label">Athena’s Last Response</div>
    <div class="preview-text" [title]="previewText">
      {{ previewText }}
    </div>
  </div>

  <div class="preview-actions">
    <button
      class="open-btn"
      (click)="openDrawer()"
      aria-haspopup="dialog"
      [attr.aria-expanded]="drawerOpen"
    >
      Open
    </button>
  </div>
</div>

<!-- Backdrop -->
@if (drawerOpen) {
<div class="drawer-backdrop" (click)="closeDrawer()" aria-hidden="true"></div>
}

<!-- Drawer Panel -->
<aside
  class="drawer-panel"
  [class.open]="drawerOpen"
  role="dialog"
  aria-label="Conversation history"
  aria-modal="true"
>
  <header class="drawer-header">
    <h3>Conversation</h3>
    <button class="close-btn" (click)="closeDrawer()" aria-label="Close conversation">✕</button>
  </header>

  <div class="drawer-body">
    @if (messages.length === 0) {
    <div class="empty">No messages yet.</div>
    } @if (messages.length > 0) {
    <ol class="message-list">
      @for (m of messages; track m.uuid) {
      <li class="message-row" [attr.data-role]="m.is_human">
        <div class="meta">
          <span class="role">{{ m.is_human ? 'You' : 'Athena' }}</span>
          @if (m.created_at) {
          <span class="time"> · {{ formatTimestamp(m.created_at) }}</span>
          }
        </div>
        <div class="body">{{ m.text }}</div>
      </li>
      }
    </ol>
    }
  </div>

  <footer class="drawer-footer">
    <app-chat-input
      [message]="message"
      [isSending]="isSending"
      [sendMessage]="sendMessage"
    ></app-chat-input>
  </footer>
</aside>
