<div id="parent-content" role="tabpanel" aria-labelledby="parent-tab" class="role-content">
  <!-- Main Dashboard -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left Panel: Child Selector + Summary -->
    <div class="bg-teal-50 p-6 rounded-2xl shadow-inner">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-teal-700 flex items-center">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="22"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-users mr-2"
          >
            <path d="M14 19a6 6 0 0 0-12 0" />
            <circle cx="8" cy="10" r="4" />
            <path d="M20 21v-2a4 4 0 0 0-4-4h-4" />
            <circle cx="16" cy="10" r="4" />
          </svg>
          Manage Children
        </h3>
        <button
          type="button"
          title="Add Child"
          (click)="openAddChildModal()"
          class="ml-3 px-3 py-2 text-sm font-medium text-teal-700 rounded-lg hover:bg-teal-50 inline-flex items-center gap-2 shadow-sm border border-teal-200"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 5v14" />
            <path d="M5 12h14" />
          </svg>
          <span>Add Child</span>
        </button>
      </div>

      <!-- Child List -->
      <div class="space-y-2 max-h-96 overflow-y-auto pr-2">
        @if (parentLoading()) {
        <div class="space-y-3">
          @for (_ of [1, 2, 3]; track _) {
          <div
            class="p-4 rounded-xl border-2 bg-white border-teal-100 animate-pulse flex justify-between items-center"
          >
            <div class="flex-1 space-y-2">
              <div class="h-4 w-2/3 bg-teal-100 rounded"></div>
              <div class="h-3 w-1/3 bg-gray-100 rounded"></div>
            </div>
            <div class="h-6 w-16 bg-teal-100 rounded-full"></div>
          </div>
          }
        </div>
        } @else if ((children() || []).length === 0) {
        <div class="p-4 bg-white border-2 border-dashed border-teal-200 rounded-xl text-center">
          <p class="text-sm text-teal-700 font-semibold mb-1">No children yet</p>
          <p class="text-xs text-gray-500 mb-3">
            Add a child to link accounts and start seeing their learning insights.
          </p>
          <button
            type="button"
            class="px-3 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 text-sm"
            (click)="openAddChildModal()"
          >
            Add Child
          </button>
        </div>
        } @else { @for (child of children(); track child.id) {
        <button
          (click)="selectChild(child.id)"
          class="w-full text-left p-4 rounded-xl border-2 transition duration-200 ease-in-out flex justify-between items-center"
          [ngClass]="{
            'bg-white border-teal-500': selectedChildId() === child.id,
            'bg-teal-100 border-transparent': selectedChildId() !== child.id,
            'border-yellow-400 bg-yellow-50': child.status === 'pending'
          }"
        >
          <div class="flex-1 flex items-center gap-3">
            <app-avatar
              [picture]="child.picture"
              [name]="child.full_name || child.name"
              sizeClass="w-9 h-9"
              class="flex-shrink-0"
            />
            <div>
              <p class="font-semibold text-teal-800 flex items-center gap-2">
              {{ child.full_name || child.name }}
            </p>
            <p class="text-sm text-gray-500">{{ child.gradeLevel }}</p>
            </div>
          </div>
          <span
            class="text-xs font-semibold px-2 py-1 rounded-full whitespace-nowrap"
            [ngClass]="{
              'bg-red-100 text-red-700 border border-red-200': child.status === 'denied',
              'bg-teal-500 text-white': selectedChildId() === child.id && child.status !== 'denied',
              'bg-teal-200 text-teal-700':
                selectedChildId() !== child.id && child.status !== 'denied'
            }"
          >
            {{ child.status === 'denied' ? 'Denied' : (child.targets?.length || 0) + ' Goals' }}
          </span>
        </button>
        } }
      </div>
    </div>

    <!-- Center Panel: Active Child Overview -->
    <div class="lg:col-span-2 bg-white border border-teal-200 p-6 rounded-2xl shadow-xl">
      @if (parentLoading()) {
      <div class="animate-pulse space-y-6">
        <div class="flex items-center justify-between">
          <div class="h-6 w-48 bg-teal-100 rounded"></div>
          <div class="h-10 w-24 bg-gray-100 rounded-lg"></div>
        </div>
        <div class="grid md:grid-cols-3 gap-4">
          @for (_ of [1, 2, 3]; track _) {
          <div class="p-4 bg-teal-50 rounded-xl">
            <div class="h-3 w-24 bg-teal-100 rounded mb-2"></div>
            <div class="h-6 w-12 bg-teal-200 rounded"></div>
          </div>
          }
        </div>
        <div class="space-y-3">
          @for (_ of [1, 2]; track _) {
          <div class="p-4 bg-gray-50 rounded-xl border border-gray-200">
            <div class="h-4 w-40 bg-gray-200 rounded mb-3"></div>
            <div class="h-3 w-full bg-gray-100 rounded"></div>
          </div>
          }
        </div>
        <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 space-y-2">
          @for (_ of [1, 2, 3]; track _) {
          <div class="h-4 w-3/4 bg-gray-100 rounded"></div>
          }
        </div>
      </div>
      } @else if (selectedChild(); as child) {

      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-teal-700 flex items-center">
          <app-avatar
            [picture]="child.picture"
            [name]="child.full_name || child.name"
            sizeClass="w-9 h-9"
            class="mr-3 flex-shrink-0"
          />
          <span>{{ child.full_name || child.name }}'s Learning Summary</span>
        </h3>

        <button
          class="px-3 py-2 text-sm font-medium text-teal-700 rounded-lg hover:bg-teal-50 flex items-center gap-2"
          (click)="goToChildOptions()"
          title="View Profile"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-eye"
          >
            <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
            <circle cx="12" cy="12" r="3" />
          </svg>
          <span>View Profile</span>
        </button>
      </div>

      @if (child.status === 'pending') {
      <div
        class="mb-6 p-4 rounded-xl border border-yellow-300 bg-yellow-50 flex flex-col md:flex-row md:items-center md:justify-between gap-3"
      >
        <div class="flex items-center gap-3">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 text-yellow-700 flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4l3 3m5-3a8 8 0 11-16 0 8 8 0 0116 0z"
            />
          </svg>
          <p class="text-sm text-yellow-900 m-0">
            This child has requested access. Approve to link accounts, or deny to remove the
            request.
          </p>
        </div>
        <div class="flex items-center gap-2">
          <button
            type="button"
            class="px-3 py-2 h-10 rounded-lg bg-teal-600 text-white hover:bg-teal-700"
            (click)="requestActionConfirmation('approve')"
          >
            Approve
          </button>
          <div class="relative">
            <button
              type="button"
              class="px-3 py-2 h-10 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 flex items-center justify-center"
              (click)="toggleActionMenu()"
              [attr.aria-expanded]="actionMenuOpen()"
              aria-haspopup="menu"
              title="More actions"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-x"
              >
                <path d="M18 6 6 18" />
                <path d="m6 6 12 12" />
              </svg>
            </button>
            @if (actionMenuOpen()) {
            <div
              class="absolute right-0 mt-2 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-30"
              role="menu"
            >
              <button
                type="button"
                class="w-full px-3 py-2 hover:bg-gray-50 flex items-center gap-2 text-left"
                (click)="requestActionConfirmation('deny')"
                role="menuitem"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-amber-700"
                >
                  <circle cx="12" cy="12" r="10" />
                  <path d="m4.9 4.9 14.2 14.2" />
                </svg>
                Deny
              </button>
              <button
                type="button"
                class="w-full px-3 py-2 text-red-700 hover:bg-red-50 flex items-center gap-2 text-left"
                (click)="requestActionConfirmation('block')"
                role="menuitem"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-red-700"
                >
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z" />
                  <path d="m9.5 9.5 5 5" />
                  <path d="m14.5 9.5-5 5" />
                </svg>
                Block
              </button>
            </div>
            }
          </div>
        </div>
      </div>
      } @if (child.status === 'denied') {
      <div
        class="mb-6 p-4 rounded-xl border border-red-200 bg-red-50 text-red-800 flex items-center justify-between gap-3"
      >
        <p class="text-sm">
          This request was denied. You can still change your mind and approve later.
        </p>
        <button
          type="button"
          class="px-3 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700"
          (click)="requestActionConfirmation('approve')"
        >
          Approve
        </button>
      </div>
      }

      <!-- Stats Overview -->
      <div class="grid md:grid-cols-3 gap-4 mb-6">
        <div class="p-4 bg-teal-50 rounded-xl text-center space-y-2">
          <p class="text-sm text-gray-600">Level</p>
          <div
            class="inline-flex items-center px-3 py-1 rounded-full bg-white text-teal-700 border border-teal-200 font-semibold"
          >
            {{ child.level || 1 }}
          </div>
          <div class="mt-3 w-full bg-teal-100 h-2 rounded-full">
            <div
              class="h-2 rounded-full bg-teal-500"
              [style.width.%]="child.level_progress ?? child.avgProgress ?? 0"
            ></div>
          </div>
          <p class="text-xs text-gray-500 mt-2">Progress to next level</p>
        </div>
        <div class="p-4 bg-teal-50 rounded-xl text-center">
          <p class="text-sm text-gray-500">Wisdom Points</p>
          <p class="text-2xl font-bold text-teal-700">
            {{ child.wisdom_points ?? child.wisdomPoints ?? 0 | number : '1.0-0' }}
          </p>
          <div
            class="mt-3 flex items-center justify-center gap-3 text-sm font-medium text-teal-700"
          >
            <button
              type="button"
              class="px-3 py-2 text-sm font-medium text-teal-700 rounded-lg hover:bg-teal-50 inline-flex items-center gap-1.5"
              routerLink="/about"
              fragment="wisdom_points"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-info"
              >
                <circle cx="12" cy="12" r="10" />
                <path d="M12 16v-4" />
                <path d="M12 8h.01" />
              </svg>
              About
            </button>
            <span class="text-gray-300">|</span>
            <button
              type="button"
              class="px-3 py-2 text-sm font-medium text-teal-700 rounded-lg hover:bg-teal-50 inline-flex items-center gap-1.5"
              routerLink="/dashboard/store"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-shopping-bag"
              >
                <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" />
                <path d="M3 6h18" />
                <path d="M16 10a4 4 0 0 1-8 0" />
              </svg>
              Store
            </button>
          </div>
        </div>
        <div class="p-4 bg-teal-50 rounded-xl text-center">
          <p class="text-sm text-gray-500">Mood Indicator</p>
          <p class="text-lg font-semibold text-gray-700">{{ child.mood || 'N/A' }}</p>
          <div
            class="mt-3 flex items-center justify-center gap-3 text-sm font-medium text-teal-700"
          >
            <button
              type="button"
              class="px-3 py-2 text-sm font-medium text-teal-700 rounded-lg hover:bg-teal-50 inline-flex items-center gap-1.5"
              routerLink="/about"
              fragment="mood_indicator"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-info"
              >
                <circle cx="12" cy="12" r="10" />
                <path d="M12 16v-4" />
                <path d="M12 8h.01" />
              </svg>
              About
            </button>
            <span class="text-gray-300">|</span>
            <button
              type="button"
              class="px-3 py-2 text-sm font-medium text-teal-700 rounded-lg hover:bg-teal-50 inline-flex items-center gap-1.5"
              (click)="openMoodSuggestions()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-sparkles"
              >
                <path d="M12 3v2" />
                <path d="M5.22 6.22 6.64 7.64" />
                <path d="M3 12h2" />
                <path d="M5.22 17.78 6.64 16.36" />
                <path d="M12 19v2" />
                <path d="m17.36 16.36 1.42 1.42" />
                <path d="M19 12h2" />
                <path d="m17.36 7.64 1.42-1.42" />
                <path d="M8 12a4 4 0 1 1 8 0 4 4 0 0 1-8 0Z" />
              </svg>
              Suggest
            </button>
          </div>
        </div>
      </div>

      <!-- Learning Goals -->
      <div class="flex items-center justify-between mb-3">
        <h4 class="text-lg font-bold text-teal-700 flex items-center gap-2">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-target w-5 h-5 shrink-0 inline-block"
            viewBox="0 0 24 24"
          >
            <circle cx="12" cy="12" r="10" />
            <circle cx="12" cy="12" r="6" />
            <circle cx="12" cy="12" r="2" />
          </svg>
          Current Learning Goals
        </h4>
        <button
          type="button"
          class="px-3 py-2 text-sm font-medium text-teal-700 rounded-lg hover:bg-teal-50 inline-flex items-center gap-2"
          (click)="goToLearningGoals()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-edit"
          >
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5Z" />
          </svg>
          Manage
        </button>
      </div>
      <div class="space-y-3">
        @if ((child.targets || []).length === 0) {
        <div class="p-4 rounded-xl border border-amber-200 bg-amber-50 text-amber-800 text-sm">
          No learning goals yet. Add a goal to guide this learner.
        </div>
        } @else { @for (goal of (child.targets || []); track goal.id) {
        <div
          class="p-4 bg-gray-50 rounded-xl border border-gray-200 shadow-sm flex flex-col md:flex-row justify-between items-start md:items-center"
        >
          <p class="font-medium text-gray-800">{{ goal.topic }}</p>
          <div class="w-full md:w-1/3 flex items-center mt-2 md:mt-0">
            <div class="w-full bg-gray-200 h-2 rounded-full mr-2">
              <div class="h-2 rounded-full bg-teal-500" [style.width.%]="goal.progress"></div>
            </div>
            <span class="text-sm text-gray-600">{{ goal.progress }}%</span>
          </div>
        </div>
        } }
      </div>

      <!-- Audit Log -->
      <div class="flex items-center justify-between mt-8 mb-3">
        <h4 class="text-lg font-bold text-teal-700 flex items-center">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-clipboard-list mr-2"
          >
            <path d="M9 12h6" />
            <path d="M9 16h6" />
            <path d="M9 8h6" />
            <path d="M4 6h16v14H4z" />
            <path d="M9 4h6v2H9z" />
          </svg>
          Recent Activity
        </h4>
        <button
          type="button"
          class="px-3 py-2 text-sm font-medium text-teal-700 rounded-lg hover:bg-teal-50 inline-flex items-center gap-2 disabled:opacity-50"
          (click)="goToActivity()"
          [disabled]="!selectedChild()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-history"
          >
            <path d="M3 3v5h5" />
            <path d="M3.05 13A9 9 0 1 0 6 5.3L3 8" />
            <path d="M12 7v5l4 2" />
          </svg>
          View All
        </button>
      </div>
      @if (!(auditTrail() || []).length) {
      <div class="p-4 rounded-xl border border-amber-200 bg-amber-50 text-amber-800 text-sm">
        Activity will appear here once this learner starts engaging.
      </div>
      } @else {
      <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 max-h-64 overflow-y-auto">
        @for (entry of auditTrail(); track entry.id) {
        <div class="py-3 border-b border-gray-100 last:border-0">
          <p class="text-sm text-gray-800">{{ entry.activity }}</p>
          <p class="text-xs text-gray-500">{{ formatActivityTime(entry.time) }}</p>
        </div>
        }
      </div>
      } } @else {
      <!-- No Child Selected -->
      <div
        class="text-center p-12 bg-teal-50 border border-teal-200 rounded-xl flex flex-col items-center justify-center"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="40"
          height="40"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-user-circle text-teal-400 mb-4"
        >
          <circle cx="12" cy="12" r="10" />
          <circle cx="12" cy="10" r="3" />
          <path d="M12 14a4 4 0 0 0 4 4H8a4 4 0 0 0 4-4Z" />
        </svg>
        <p class="text-lg font-semibold text-teal-700 mb-2">Select a Child</p>
        <p class="text-gray-500">
          Choose a child from the list to view their learning insights and audit trail.
        </p>
      </div>
      }
    </div>
  </div>
  @if (showAddChildModal()) {
  <div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-teal-700">Add Child</h3>
        <button
          type="button"
          class="text-gray-500 hover:text-gray-700"
          aria-label="Close"
          (click)="closeAddChildModal()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6 6 18" />
            <path d="m6 6 12 12" />
          </svg>
        </button>
      </div>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
          <input
            type="text"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500"
            [value]="newChild().full_name"
            (input)="onChildFieldChange('full_name', $any($event.target).value)"
            placeholder="e.g., Alex Johnson"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input
            type="email"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500"
            [value]="newChild().email"
            (input)="onChildFieldChange('email', $any($event.target).value)"
            placeholder="child@example.com"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Birthday</label>
          <input
            type="date"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500"
            [value]="newChild().birthday"
            (input)="onChildFieldChange('birthday', $any($event.target).value)"
          />
        </div>
      </div>
      <div class="mt-6 flex justify-end space-x-3">
        <button
          type="button"
          class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50"
          (click)="closeAddChildModal()"
        >
          Cancel
        </button>
        <button
          type="button"
          class="px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700"
          (click)="saveChild()"
        >
          Save
        </button>
      </div>
    </div>
  </div>
  } @if (pendingAction(); as pending) {
  <div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
      <h3 class="text-xl font-bold text-gray-800 mb-2">
        Confirm
        {{ pending.type === 'approve' ? 'Approval' : pending.type === 'deny' ? 'Denial' : 'Block' }}
      </h3>
      <p class="text-sm text-gray-600 mb-4">
        Are you sure you want to
        {{ pending.type === 'approve' ? 'approve' : pending.type === 'deny' ? 'deny' : 'block' }}
        {{ pending.childName }}? A confirmation from a guardian is required before they can access
        this app.
      </p>
      <div class="mt-4 flex justify-end space-x-3">
        <button
          type="button"
          class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50"
          (click)="cancelPendingAction()"
        >
          Cancel
        </button>
        <button
          type="button"
          class="px-4 py-2 rounded-lg text-white"
          [ngClass]="{
            'bg-teal-600 hover:bg-teal-700': pending.type === 'approve',
            'bg-amber-600 hover:bg-amber-700': pending.type === 'deny',
            'bg-red-600 hover:bg-red-700': pending.type === 'block'
          }"
          (click)="confirmPendingAction()"
        >
          {{ pending.type === 'approve' ? 'Approve' : pending.type === 'deny' ? 'Deny' : 'Block' }}
        </button>
      </div>
    </div>
  </div>
  } @if (moodSuggestionsOpen()) {
  <div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 space-y-4">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm uppercase tracking-wide text-teal-600 font-semibold m-0">
            AI suggestions
          </p>
          <h3 class="text-xl font-bold text-gray-900 m-0">Mood-based tips</h3>
        </div>
        <button
          type="button"
          class="text-gray-500 hover:text-gray-700"
          aria-label="Close"
          (click)="closeMoodSuggestions()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6 6 18" />
            <path d="m6 6 12 12" />
          </svg>
        </button>
      </div>
      <p class="text-sm text-gray-600 m-0">
        Based on recent activity, here are quick actions you can take to improve engagement.
      </p>
      <div class="space-y-3">
        @for (item of moodSuggestions(); track item.title) {
        <div class="p-4 rounded-xl border border-gray-200">
          <p class="font-semibold text-gray-800 mb-1">{{ item.title }}</p>
          <p class="text-sm text-gray-600 m-0">{{ item.body }}</p>
        </div>
        }
      </div>
      <div class="flex justify-end">
        <button
          type="button"
          class="px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700"
          (click)="closeMoodSuggestions()"
        >
          Got it
        </button>
      </div>
    </div>
  </div>
  }
</div>
