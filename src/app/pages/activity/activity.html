<div class="max-w-6xl mx-auto p-6 space-y-6">
  <app-breadcrumb
    [labels]="breadcrumbLabels()"
    [showDashboardCrumb]="true"
    [disableDashboard]="false"
  ></app-breadcrumb>

  <div class="flex flex-wrap items-center justify-between gap-3">
    <div>
      <h1 class="text-3xl font-bold text-teal-700">{{ childName() }}'s Activity</h1>
    </div>
    <div class="flex items-center gap-3">
      <input
        type="search"
        class="border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-teal-200"
        placeholder="Search activity"
        [value]="search()"
        (input)="search.set($any($event.target).value); page.set(1)"
      />
    </div>
  </div>

  <div class="bg-white border border-slate-200 rounded-2xl shadow-sm overflow-hidden">
    @if (loading()) {
    <div class="p-6 space-y-3 animate-pulse">
      <div class="h-6 w-1/3 bg-slate-100 rounded"></div>
      <div class="h-4 w-1/4 bg-slate-100 rounded"></div>
      <div class="h-10 bg-slate-100 rounded"></div>
      <div class="h-10 bg-slate-100 rounded"></div>
      <div class="h-10 bg-slate-100 rounded"></div>
    </div>
    } @else if ((rows() || []).length === 0) {
    <div class="p-8 text-center space-y-3">
      <h2 class="text-lg font-semibold text-slate-700">No activity yet</h2>
      <p class="text-sm text-slate-500">
        When this learner interacts with Athena, you'll see the most recent activity here.
      </p>
    </div>
    } @else {
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200 text-sm">
        <thead class="bg-slate-50 text-slate-600">
          <tr>
            <th class="px-4 py-3 text-left font-semibold">
              <button class="flex items-center gap-1" (click)="setSort('activity')">
                Activity
                <span class="text-xs text-slate-400" *ngIf="sortField() === 'activity'">
                  {{ sortDir() === 'asc' ? '↑' : '↓' }}
                </span>
              </button>
            </th>
            <th class="px-4 py-3 text-left font-semibold">
              <button class="flex items-center gap-1" (click)="setSort('time')">
                When
                <span class="text-xs text-slate-400" *ngIf="sortField() === 'time'">
                  {{ sortDir() === 'asc' ? '↑' : '↓' }}
                </span>
              </button>
            </th>
            <th class="px-4 py-3 text-left font-semibold">Actor</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          @for (entry of displayRows(); track entry.id) {
          <tr class="hover:bg-slate-50">
            <td class="px-4 py-3 text-slate-800 font-medium">{{ entry.activity }}</td>
            <td class="px-4 py-3 text-slate-700">{{ formattedTime(entry.time) }}</td>
            <td class="px-4 py-3 text-slate-700">
              <div class="flex items-center gap-3">
                <div
                  class="h-10 w-10 rounded-full bg-slate-100 border border-slate-200 flex items-center justify-center text-slate-600 font-semibold"
                >
                  {{
                    (actorLabel(entry) || 'A').toString().trim().slice(0, 1).toUpperCase()
                  }}
                </div>
                <div>
                  <div class="font-semibold text-slate-800">
                    {{ actorLabel(entry) }}
                  </div>
                  <div class="text-xs text-slate-500">
                    {{
                      entry.actor_email ||
                        (entry.actor_profile_id ? 'ID: ' + entry.actor_profile_id : 'Athena')
                    }}
                  </div>
                </div>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }
  </div>

  <div class="flex flex-wrap items-center justify-between gap-3 text-sm" *ngIf="total() > 0">
    <div class="text-slate-600">
      Showing
      <strong>{{ rangeStart() }}</strong>
      -
      <strong>{{ rangeEnd() }}</strong>
      of <strong>{{ total() }}</strong>
    </div>
    <div class="flex items-center gap-3">
      <div class="flex items-center gap-1">
        <button
          type="button"
          class="px-3 py-2 rounded-lg border border-slate-200 bg-white text-slate-700 hover:bg-slate-50 disabled:opacity-50"
          (click)="goToPage(page() - 1)"
          [disabled]="page() <= 1"
        >
          Previous
        </button>
        <button
          type="button"
          class="px-3 py-2 rounded-lg border border-slate-200 bg-white text-slate-700 hover:bg-slate-50 disabled:opacity-50"
          (click)="goToPage(page() + 1)"
          [disabled]="page() >= totalPages()"
        >
          Next
        </button>
      </div>
      <span class="text-slate-500">Page {{ page() }} of {{ totalPages() }}</span>
      <label class="flex items-center gap-2 text-slate-600">
        Per page
        <select
          class="border border-slate-200 rounded-lg px-2 py-1"
          [value]="pageSize()"
          (change)="changePageSize($any($event.target).value)"
        >
          <option [value]="5">5</option>
          <option [value]="10">10</option>
          <option [value]="20">20</option>
          <option [value]="50">50</option>
        </select>
      </label>
    </div>
  </div>
</div>
